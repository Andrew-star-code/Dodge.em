<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Информационный портал</title>
    <link href="Content/css/bootstrap.css" rel="stylesheet">
    <link href="Content/css/roboto/roboto.css" rel="stylesheet">
    <link href="Content/css/bootsrap-extensions.css" rel="stylesheet">
    <link href="Content/css/styles-block.css" rel="stylesheet">
    <link href="Content/css/button.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f8f9ff 0%, #fff5f8 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .birthDayFont {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #E8A5C0 0%, #C8A8D4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .birthDayInfo {
            font-family: 'Inter', sans-serif;
            font-size: 1.1rem;
            font-weight: 500;
            color: #2d3748;
        }

        #tomorrowDayBlock {
            position: relative;
            padding: 24px;
        }

        #bitrhDayTomorrow {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px) saturate(180%);
            border-radius: 24px;
            padding: 32px 24px;
            box-shadow: 0 8px 32px rgba(184, 212, 232, 0.12), 
                        0 2px 8px rgba(0, 0, 0, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.6);
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #bitrhDayTomorrow::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(232, 165, 192, 0.03) 0%, transparent 70%);
            pointer-events: none;
        }

        #bitrhDayTomorrow:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 48px rgba(184, 212, 232, 0.18),
                        0 4px 12px rgba(0, 0, 0, 0.06);
        }

        #bitrhDayTomorrow h4 {
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid rgba(232, 165, 192, 0.2);
            position: relative;
            font-weight: 600;
            font-size: 1.25rem;
        }

        .birthday-folder {
            margin-bottom: 12px;
        }

        .folder-header {
            display: flex;
            align-items: center;
            padding: 14px 18px;
            background: linear-gradient(135deg, rgba(184, 212, 232, 0.08) 0%, rgba(200, 168, 212, 0.08) 100%);
            border: 1px solid rgba(184, 212, 232, 0.2);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none;
        }

        .folder-header:hover {
            background: linear-gradient(135deg, rgba(184, 212, 232, 0.15) 0%, rgba(200, 168, 212, 0.15) 100%);
            transform: translateX(4px);
            border-color: rgba(184, 212, 232, 0.4);
        }

        .folder-icon {
            font-size: 0.9rem;
            margin-right: 12px;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: #B8D4E8;
            font-weight: 600;
        }

        .folder-icon.expanded {
            transform: rotate(90deg);
        }

        .folder-title {
            color: #4a5568;
            font-weight: 600;
            font-size: 0.95rem;
            margin: 0;
            flex: 1;
        }

        .folder-count {
            background: linear-gradient(135deg, #B8D4E8 0%, #A8C7E0 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(184, 212, 232, 0.3);
        }

        .folder-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), 
                        padding 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 0 8px;
        }

        .folder-content.expanded {
            max-height: 1000px;
            padding: 12px 8px;
        }

        .folder-content a {
            display: block;
            padding: 14px 16px;
            margin: 8px 0;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 14px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 3px solid #B8D4E8;
            text-decoration: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .folder-content a:hover {
            transform: translateX(6px);
            box-shadow: 0 4px 16px rgba(184, 212, 232, 0.2);
            background: rgba(255, 255, 255, 0.95);
            border-left-color: #C8A8D4;
            text-decoration: none;
        }

        .folder-content a p {
            margin: 0;
            transition: all 0.3s ease;
            color: #4a5568;
            font-weight: 500;
        }

        .folder-content a:hover p {
            color: #C8A8D4 !important;
        }

        .folder-content a b {
            font-size: 0.95rem;
            display: block;
            line-height: 1.5;
            font-weight: 600;
        }

        #birthdayBlock {
            padding: 24px;
            position: relative;
        }

        #birthdayBlock h1 {
            animation: fadeInScale 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            margin-bottom: 40px;
            position: relative;
            display: inline-block;
            left: 50%;
            transform: translateX(-50%);
            font-weight: 700;
        }

        #birthdayBlock h1::after {
            content: '🎂';
            margin-left: 20px;
            display: inline-block;
            animation: gentleBounce 3s ease-in-out infinite;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        @keyframes gentleBounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-8px);
            }
        }

        .birthday-block {
            background: rgba(255, 255, 255, 0.7) !important;
            backdrop-filter: blur(20px) saturate(180%);
            border-radius: 24px;
            padding: 32px;
            box-shadow: 0 8px 32px rgba(232, 165, 192, 0.08),
                        0 2px 8px rgba(0, 0, 0, 0.04);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.6);
            position: relative;
            overflow: hidden;
            animation: slideUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .birthday-block::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 218, 185, 0.05) 0%, transparent 70%);
            pointer-events: none;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .birthday-block:hover {
            transform: translateY(-8px);
            box-shadow: 0 16px 48px rgba(232, 165, 192, 0.15),
                        0 8px 16px rgba(0, 0, 0, 0.06);
            border-color: rgba(232, 165, 192, 0.3);
        }

        .birthday-block .user-photo {
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
            border: 3px solid rgba(255, 255, 255, 0.9);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .birthday-block:hover .user-photo {
            transform: scale(1.03);
            box-shadow: 0 12px 32px rgba(232, 165, 192, 0.2);
            border-color: rgba(232, 165, 192, 0.3);
        }

        .birthday-block .img-photo {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .birthday-block:hover .img-photo {
            filter: brightness(1.05) saturate(1.1);
        }

        .birthday-FIO-block h6 a {
            background: linear-gradient(135deg, #C8A8D4 0%, #E8A5C0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            position: relative;
            display: inline-block;
        }

        .birthday-FIO-block h6 a::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(135deg, #C8A8D4 0%, #E8A5C0 100%);
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 2px;
        }

        .birthday-FIO-block h6 a:hover::after {
            width: 100%;
        }

        .birthday-FIO-block h6 a:hover {
            transform: translateY(-2px);
        }

        .birthday-FIO-block img {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 12px;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1));
        }

        .birthday-FIO-block img:hover {
            transform: scale(1.1) rotate(3deg);
            filter: drop-shadow(0 6px 12px rgba(200, 168, 212, 0.3));
        }

        .tomorrow-text:hover {
            text-decoration: none;
        }

        #birthdayBlock::before,
        #birthdayBlock::after {
            content: '';
            position: absolute;
            width: 100px;
            height: 100px;
            opacity: 0.05;
            pointer-events: none;
        }

        #birthdayBlock::before {
            top: 40px;
            left: 40px;
            background: radial-gradient(circle, #E8A5C0 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        #birthdayBlock::after {
            bottom: 40px;
            right: 40px;
            background: radial-gradient(circle, #B8D4E8 0%, transparent 70%);
            animation: float 6s ease-in-out infinite 3s;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0) scale(1);
            }
            50% {
                transform: translateY(-20px) scale(1.1);
            }
        }

        @media (max-width: 992px) {
            #birthdayBlock h1 {
                font-size: 4rem !important;
            }
            
            .birthday-block {
                margin-bottom: 24px;
            }
        }

        @media (max-width: 768px) {
            #birthdayBlock h1 {
                font-size: 3rem !important;
            }
            
            #tomorrowDayBlock,
            #birthdayBlock {
                padding: 16px;
            }
        }

        .modal-content {
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 24px 64px rgba(0, 0, 0, 0.12);
            overflow: hidden;
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.95);
        }

        .modal-header {
            background: linear-gradient(135deg, #B8D4E8 0%, #A8C7E0 100%);
            color: white;
            padding: 28px 32px;
            border-bottom: none;
            position: relative;
        }

        .modal-header::after {
            content: '✨';
            position: absolute;
            right: 32px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 28px;
            opacity: 0.4;
        }

        .modal-header h4,
        .modal-header h6 {
            color: white;
            margin: 0;
            font-weight: 600;
            text-shadow: none;
            font-family: 'Inter', sans-serif;
        }

        .modal-body {
            padding: 32px;
            background: white;
        }

        .modal-body img {
            border-radius: 20px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
            border: 3px solid #f8f9fa;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal-body img:hover {
            transform: scale(1.03);
        }

        #birthDayMoreInfo h4 {
            background: linear-gradient(135deg, #C8A8D4 0%, #E8A5C0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            margin-bottom: 24px;
            font-size: 1.5rem;
        }

        #birthDayMoreInfo p {
            padding: 14px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 1rem;
            color: #4a5568;
            line-height: 1.6;
        }

        #birthDayMoreInfo p:last-child {
            border-bottom: none;
        }

        #birthDayMoreInfo p b {
            color: #C8A8D4;
            font-weight: 600;
        }

        .modal-footer {
            background: #fafbfc;
            padding: 24px 32px;
            border-top: 1px solid #f0f0f0;
        }

        .modal-footer .btn {
            border-radius: 14px;
            padding: 12px 28px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
        }

        .modal-footer .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }

        .modal-footer .btn-danger {
            background: linear-gradient(135deg, #e8a5c0 0%, #d895b0 100%);
            box-shadow: 0 4px 12px rgba(232, 165, 192, 0.3);
        }

        .modal-footer .btn-danger:hover {
            background: linear-gradient(135deg, #d895b0 0%, #c885a0 100%);
        }

        .modal-footer .btn-success {
            background: linear-gradient(135deg, #B8D4E8 0%, #A8C7E0 100%);
            box-shadow: 0 4px 12px rgba(184, 212, 232, 0.3);
        }

        .modal-footer .btn-success:hover {
            background: linear-gradient(135deg, #A8C7E0 0%, #98B7D0 100%);
        }

        .form-control {
            border-radius: 14px;
            border: 2px solid #e8ecf0;
            padding: 14px 16px;
            font-size: 0.95rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Inter', sans-serif;
            background: rgba(255, 255, 255, 0.8);
        }

        .form-control:focus {
            border-color: #B8D4E8;
            box-shadow: 0 0 0 4px rgba(184, 212, 232, 0.1);
            outline: none;
            background: white;
        }

        #complimentModal .modal-body p {
            color: #4a5568;
            margin-bottom: 16px;
            line-height: 1.6;
        }

        #complinemt_title {
            background: linear-gradient(135deg, #C8A8D4 0%, #E8A5C0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            margin: 24px 0;
        }

        #errorText {
            margin-top: 12px;
            padding: 12px 16px;
            background: rgba(232, 165, 192, 0.1);
            border-radius: 12px;
            border-left: 3px solid #E8A5C0;
            color: #d85a7a;
            font-size: 0.9rem;
        }

        .alertInfoBlock {
            border-radius: 14px;
            padding: 16px;
            margin-top: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        #tgNoneModal .modal-body {
            text-align: center;
            padding: 48px 32px;
        }

        #tgNoneModal .modal-body p {
            font-size: 1.05rem;
            color: #4a5568;
            margin-bottom: 12px;
            line-height: 1.6;
        }

        #tgNoneModal .modal-body h6 {
            background: linear-gradient(135deg, #E8A5C0 0%, #C8A8D4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            font-size: 1.4rem;
            margin: 24px 0;
        }

        .modal-dialog {
            margin: 50px auto;
        }

        @media (min-width: 576px) {
            .modal-dialog {
                max-width: 600px;
            }
        }

        .down-button-back {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px) saturate(180%);
            border-radius: 20px;
            padding: 16px;
            margin-top: 16px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.6);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .down-button-back:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            border-color: rgba(184, 212, 232, 0.4);
        }

        .BackButtonTitle h2 {
            background: linear-gradient(135deg, #B8D4E8 0%, #C8A8D4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div id="top_menu" class="topBlock" style="width: 100%;">
        <div id="logo">
            <a href="#" onclick="BackPage(GetIndexPage(), true)"><img id="imgLogo" src="img/logo.png" class="img-fluid"></a>
        </div>
        <div id="topInfoBlock">
            <div id="DateBlock">
                <table style="width: 100%; height: 100%;">
                    <tbody>
                        <tr>
                            <td id="DateVal" width="70%" class="td-date-block"><h5></h5></td>
                            <td id="TimeVal" width="30%" class="td-time-block"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="UpSpace"></div>
    <div id="fixedUp" class="fixUp"></div>

    <div id="MainBlock">
        <div id="logOffBox" class="logoff-box non-visible">
            <table style="width: 100%; height: 100%;">
                <tbody>
                    <tr>
                        <td class="td-center color-white">
                            <h1 id="logOffText"></h1>
                        </td>
                    </tr>
                    <tr>
                        <td class="td-center color-white">
                            <button class="col-lg-3 btn btn-danger" onclick="LogOff()" style="font-size: 2rem">OK</button>
                            <button class="col-lg-3 offset-lg-1 btn btn-success" onclick="LogOnContinue()" style="font-size: 2rem">Продолжить сеанс</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="row col-content-block" style="width: 100%">
            <div id="tomorrowDayBlock" class="col-lg-3">
                <div id="bitrhDayTomorrow">
                    <h4 class="birthDayFont" style="text-align: center">Ближайшие дни рождения</h4>
                </div>
                <a id="backLink" href="#">
                    <div class="down-button-back">
                        <div class="BackButtonTitle">
                            <table class="backTable"><tbody><tr><td class="back-td"><h2 style="margin-right: 10%">НАЗАД</h2></td></tr></tbody></table>
                        </div>
                    </div>
                </a>
            </div>

            <div id="birthdayBlock" class="col-lg-8">
                <h1 class="birthDayFont" style="text-align: center; font-size: 6rem">Именинники сегодня</h1>
            </div>
        </div>

        <div id="birthDayModal" class="modal fade">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h6 id="ModalTitle" class="Modal-Title"></h6>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-lg-3">
                                <img id="user_photo" class="img-fluid" src="" />
                            </div>
                            <div class="col-lg-1"></div>
                            <div id="birthDayMoreInfo" class="col-lg-8"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger modal-close-btn" data-dismiss="modal" onclick="">Закрыть</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="complimentModal" class="modal fade">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 id="ModalTitle" class="Modal-Title" style="text-align: center">Поздравление именинника</h4>
                    </div>
                    <div class="modal-body">
                        <p style="text-align: center; font-size: 1.2rem"> Напишите и отправьте ваше поздравление! </p>
                        <h4 id="complinemt_title" style="text-align: center"> </h4>
                        <p style="text-align: center; font-size: 1.2rem">Получит его в Telegram</p>
                        <div class="form-group">
                            <label for="congratulatonsText"></label>
                            <textarea id="congratulatonsText" rows="7" class="form-control" placeholder="Текст поздравления"></textarea>
                            <p id="errorText" style="color: red" class="non-visible"></p>
                            <div id="birthDaySendAlert" class="alertInfoBlock non-visible">
                                <table class="full-table"><tbody><tr><td class="td-center color-white"><h4 id="birthDaySendMessage"></h4></td></tr></tbody></table>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="ButSendCompliment" type="button" class="btn btn-success col-lg-4">Отправить поздравление</button>
                        <button type="button" class="btn btn-danger col-lg-4 modal-close-btn" data-dismiss="modal" onclick="onCloseModal()">Закрыть</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="tgNoneModal" class="modal fade">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h6 id="ModalTitle" class="Modal-Title"></h6>
                    </div>
                    <div class="modal-body">
                        <div style="text-align: center">
                            <p>Нам очень жаль!</p>
                            <h6 id="noTgFIO"></h6>
                            <p>не подключил(а) Telegram-бот в личном кабинете.</p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger modal-close-btn" data-dismiss="modal" onclick="">Закрыть</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/jquery-3.5.1.min.js" type="text/javascript"></script>
    <script src="js/bootstrap/bootstrap.js" type="text/javascript"></script>
    <script src="js/bootstrap/bootstrap.min.js" type="text/javascript"></script>
    <script src="js/extensionData.js" type="text/javascript"></script>
    <script src="js/common.js" type="text/javascript"></script>
    <script>
        let birthDays = new Array();
        let todayBirthDays;
        let tomorrowBirthDays;
        let afterTommorowBirthDays;
        let userData = null;
        let closeTimer = null;
        let isSetSendHandler = false;
        let reset;

        window.onload = function () {            
            let backlink = document.getElementById("backLink");
            let link = document.referrer;
            if (backlink) {
                backlink.setAttribute("onclick", `window.location.href = '${link}'`);
                if (document.referrer.indexOf("personal") == -1) {
                    window.sessionStorage.removeItem("authData");
                }
            }
            SetTopBlock();
            SetMainBlockHeight();
            userData = JSON.parse(window.sessionStorage.getItem("authData"));
            document.body.style.background = `url(img/PhoneImg/birthday.jpg)`;
            document.body.style.backgroundSize = "contain";
            GetDate();
            SetLogOffText("Из-за отсутствия активности \n мы на всякий случай \n завершили сеанс \n для вашей безопасности");
            let timer = setTimeout(GetDate, 1000);
            getBirthDays();
            reset = (userData != null) ? setTimeout(LogOffMessage, logOffTime) : setTimeout(BackPage, logOffTime, GetIndexPage(), false);
        };

        document.addEventListener('mousemove', function () {
            clearTimeout(reset);
            reset = (userData != null) ? setTimeout(LogOffMessage, logOffTime) : setTimeout(BackPage, logOffTime, GetIndexPage(), false);
        });
        
        document.addEventListener('click', function () {
            clearTimeout(reset);
            reset = (userData != null) ? setTimeout(LogOffMessage, logOffTime) : setTimeout(BackPage, logOffTime, GetIndexPage(), false);
        });

        window.onresize = function () {
            SetTopBlock();
            SetMainBlockHeight();
            SetBackBlock();
            GetDate();
        };

        function getBirthDays() {
            $.ajax({
                type: 'GET',
                url: 'api/BirthDay/', 
                success: function (data) {
                    let content = document.getElementById("birthdayBlock");
                    let rowBlock = CreateRowBlock(); 
                    $.each(data, function (index, birthday) {
                        birthDays.push(birthday);                        
                    });
                    todayBirthDays = birthDays.filter(item => item.Day === 0);
                    tomorrowBirthDays = birthDays.filter(item => item.Day === 1);                    
                    afterTommorowBirthDays = birthDays.filter(item => item.Day === 2);       
                    GetTodayBirthDays(todayBirthDays);
                    
                    // Combine tomorrow and after tomorrow for the folder display
                    let upcomingBirthdays = [...tomorrowBirthDays, ...afterTommorowBirthDays];
                    GetBirthDayTomorrow(upcomingBirthdays);
                },
                dataType: 'json'
            });
        }

        function CreateRowBlock() {
            let block = document.createElement("div");
            block.classList.add("row");
            return block;
        }

        function LoadBirthDayModal(id) {
            if (!id) return;
            let data = birthDays.find(item => item.Id === id);
            if (data == null) return;
            let aboutUserBlock = document.getElementById("birthDayMoreInfo");
            aboutUserBlock.innerHTML = "";
            let img = document.getElementById("user_photo");
            img.setAttribute("src", "http://sr-tpserver/my_web/site-extensions/Phone/Foto/" + data.Foto + ".jpg");
            let fio = document.createElement("h4");
            fio.innerText = data.FIO;
            let post = document.createElement("p");
            post.innerHTML = `<b>Должность: </b> ${data.Post}`;
            let department = document.createElement("p");
            department.innerHTML = `<b>Подразделение: </b> ${data.Department}`;
            let phone = document.createElement("p");
            phone.innerHTML = `<b>Внутренний телефон: </b> ${data.Phone}`;
            aboutUserBlock.append(fio);
            aboutUserBlock.append(post);
            aboutUserBlock.append(department);
            aboutUserBlock.append(phone);
        }

        function GetTodayBirthDays(data) {
            let content = document.getElementById("birthdayBlock");
            let rowBlock = CreateRowBlock(); 
            $.each(data, function (index, birthday) {
                let block = document.createElement("div");
                block.classList.add('col-lg-5');
                block.classList.add('birthday-block');
                let photoBlock = CreateHTMLBlock("photo-block", "user-photo-block");
                let upPhotoSpace = CreateHTMLBlock("upPhotoSpace", "up-photo-space");
                let contentPhoto = CreateHTMLBlock("photo-content", "user-photo");
                let imgBlock = CreateHTMLBlock("img-block", "full-size");
                let photoImg = CreateHTMLBlock("image-photo", "img-photo", "img");
                photoImg.setAttribute("src", "http://sr-tpserver/my_web/site-extensions/Phone/Foto/" + birthday.Foto + ".jpg");
                imgBlock.append(photoImg);
                photoBlock.append(upPhotoSpace);
                contentPhoto.append(imgBlock);
                photoBlock.append(contentPhoto);
                block.append(photoBlock);
                let fioBlock = document.createElement("div");
                fioBlock.classList.add("birthday-FIO-block");
                let tgBlock = (userData != null) ? ((birthday.isTgActive == true) ? `</tr><tr><td><a id='tg-${birthday.Id}' href='#complimentModal' fio='${birthday.FIO}' data-toggle='modal' onclick = 'OpenComplimentForm(${birthday.Id}, this)'><img style='height: 40px' class='img-fluid' src='img/QR/telegram.png'></a></td></tr>`
                    : `</tr><tr><td><a id='tg-${birthday.Id}' href='#tgNoneModal' fio='${birthday.FIO}' data-toggle='modal' onclick = 'OpenNoTgForm(this)'><img style='height: 40px' class='img-fluid' src='img/QR/telegram_none.png'></a></td></tr>`) : '';
                fioBlock.innerHTML = `<table class='full-table'>
                                        <tbody><tr><td class='td-center'><h6 class='birthDayInfo'><a href="#birthDayModal" data-toggle="modal" onclick='LoadBirthDayModal(${birthday.Id})' style="color: red">${birthday.FIO}</a></h6><p style = 'color: #295874; font-size: 0.9rem'>${birthday.Post}</p><td>
                                        ${tgBlock}
                                    </tbody></table>`;
                let horizontalSpace = document.createElement("div");
                horizontalSpace.style.cssFloat = "left";
                horizontalSpace.style.width = '10%';
                horizontalSpace.style.height = '100%';
                block.append(horizontalSpace);
                block.append(fioBlock);
                rowBlock.append(block);
                if (index % 2 == 0 && index != data.length - 1) {
                    let spaceBlock = document.createElement("div");
                    spaceBlock.style.height = "100%";
                    spaceBlock.classList.add("col-lg-2");
                    rowBlock.append(spaceBlock);
                }
                if ((index % 2 == 1) || index == data.length - 1) {
                    content.append(rowBlock);
                    let upSpace = document.createElement("div");
                    upSpace.classList.add("col-lg-12");
                    upSpace.style.height = "5%";
                    content.append(upSpace);
                    rowBlock = CreateRowBlock();
                }
            });
        }

        function GetBirthDayTomorrow(data) {  
            let tomorrowBlock = document.getElementById("bitrhDayTomorrow");
            
            // Group by day
            let tomorrowOnly = data.filter(item => item.Day === 1);
            let afterTomorrowOnly = data.filter(item => item.Day === 2);
            
            // Create folder for tomorrow's birthdays
            if (tomorrowOnly.length > 0) {
                let tomorrowFolder = createBirthdayFolder('Завтра', tomorrowOnly, 'tomorrow-folder');
                tomorrowBlock.appendChild(tomorrowFolder);
            }
            
            // Create folder for after tomorrow's birthdays
            if (afterTomorrowOnly.length > 0) {
                let afterTomorrowFolder = createBirthdayFolder('Послезавтра', afterTomorrowOnly, 'after-tomorrow-folder');
                tomorrowBlock.appendChild(afterTomorrowFolder);
            }
        }

        function createBirthdayFolder(title, birthdays, folderId) {
            let folder = document.createElement('div');
            folder.classList.add('birthday-folder');
            
            let header = document.createElement('div');
            header.classList.add('folder-header');
            header.onclick = function() { toggleFolder(folderId); };
            
            let icon = document.createElement('span');
            icon.classList.add('folder-icon');
            icon.id = folderId + '-icon';
            icon.innerText = '▶';
            
            let folderTitle = document.createElement('span');
            folderTitle.classList.add('folder-title');
            folderTitle.innerText = title;
            
            let count = document.createElement('span');
            count.classList.add('folder-count');
            count.innerText = birthdays.length;
            
            header.appendChild(icon);
            header.appendChild(folderTitle);
            header.appendChild(count);
            
            let content = document.createElement('div');
            content.classList.add('folder-content');
            content.id = folderId + '-content';
            
            birthdays.forEach(function(birthday) {
                let link = document.createElement("a");
                let birthMan = document.createElement("p");
                let b = document.createElement("b");                
                b.innerText = birthday.FIO;         
                b.style.fontSize = "0.95rem";
                birthMan.style.textAlign = "center";
                birthMan.style.color = "#295874";
                birthMan.append(b);                    
                link.setAttribute("href", "#birthDayModal");
                link.setAttribute("data-toggle", "modal");
                link.setAttribute("onclick", `LoadBirthDayModal(${birthday.Id})`);
                link.append(birthMan);
                content.appendChild(link);
            });
            
            folder.appendChild(header);
            folder.appendChild(content);
            
            return folder;
        }

        function toggleFolder(folderId) {
            let content = document.getElementById(folderId + '-content');
            let icon = document.getElementById(folderId + '-icon');
            
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                icon.classList.remove('expanded');
            } else {
                content.classList.add('expanded');
                icon.classList.add('expanded');
            }
        }

        function OpenComplimentForm(id, item) {
            let fio = item.getAttribute('fio');
            if (userData == null) return;
            ShowHideItem("ButSendCompliment", true);
            let data = birthDays.find(item => item.Id === id);
            let uid = data.Uid;        
            let myName = userData.FullName;            
            let ComplimentTitle = document.getElementById("complinemt_title");
            ComplimentTitle.innerText = fio;
            ShowHideItem("congratulatonsText", true);
            ShowHideItem("birthDaySendAlert", false);
            if (isSetSendHandler == false) {                
                let btnSend = document.getElementById("ButSendCompliment");   
                btnSend.addEventListener('click', function () {                
                    SendCompliment(uid, myName);
                });
                isSetSendHandler = true;
            }
        }

        function OpenNoTgForm(item) {
            if (item == null) return;
            let noTgFIO = document.getElementById("noTgFIO");
            noTgFIO.innerText = item.getAttribute("fio");
        }

        function SendCompliment(uid, myName) {
            let complimentModal = document.getElementById("complimentModal");
            let complinentInput = document.getElementById("congratulatonsText");
            let compliment = complinentInput.value;
            let errorText = document.getElementById("errorText");
            if (!compliment) {
                ShowHideItem("errorText", true);
                errorText.innerText = "Пожалуйста, напишите текст поздравления!";
                return;
            }
            ShowHideItem("errorText", false);
            $.ajax({
                type: 'POST',
                url: 'api/BirthDay/',                
                data: { Uid : uid, FIOSender: myName, Compliment : compliment },
                success: function (data) {
                    if (data.ServiceData == true) {
                        SetMessage("congratulatonsText", "");
                        ShowHideItem("congratulatonsText", false);
                        ShowHideItem("birthDaySendAlert", true);
                        SetItemBackground("birthDaySendAlert", "1EC832");
                        SetMessage("birthDaySendMessage", "Ваше поздравление успешно отправлено!");
                        ShowHideItem("ButSendCompliment", false);
                        closeTimer = setTimeout(CloseSendForm, 5000); 
                    } else {
                        if (data.isError != null) {
                            ShowHideItem("birthDaySendAlert", true);
                            SetItemBackground("birthDaySendAlert", "E51400");
                            closeTimer = setTimeout(CloseSendForm, 5000);
                        }
                    }
                    complinentInput.value = "";
                },
                dataType: 'JSON'
            });
        }

        function CloseSendForm() {
            let modal = document.getElementById("complimentModal");
            let text = document.getElementById("congratulatonsText"); 
            text.value = "";
            document.querySelector('#complimentModal .modal-close-btn').click();
        }

        function onCloseModal() {
            if (closeTimer) {
                clearTimeout(closeTimer);
                closeTimer = null;
            }
        }
    </script>
</body>
</html>